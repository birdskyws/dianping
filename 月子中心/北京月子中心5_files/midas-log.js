!function(){function t(t,e){for(var n in e)t[n]=e[n];return t}var e="jquery@^1.9.2",n="midas-log@0.0.3/lib/log-server.js",i="midas-log@0.0.3/index.js",o={},r=o;define(i,[e,n],function(t,e,n,i,o){"use strict";var r,a=t("jquery"),d=t("./lib/log-server.js"),c=document.compatMode&&"CSS1Compat"!==document.compatMode?document.body:document.documentElement,u=d(),s="midasclick",f=-1,l=function(t,e){document.cookie=t+"="+encodeURIComponent(e)+";path=/"},m=function(t){for(var e=t.offsetTop,n=t.offsetParent;n;)e+=n.offsetTop,n=n.offsetParent;return e},g=function(){return a("[data-midas]")},p=function(t,e){for(var n,i=t.parentNode;"BODY"!==i.nodeName&&!i.getAttribute(e);)i=i.parentNode;return n=i.getAttribute(e)},v=function(t,e){a(t).on("click",e)},b=function(t,e,n){var i="";t&&(i=t.indexOf("?")>f?t:u+decodeURIComponent(t),i=i+"&act="+e+"&referer="+encodeURIComponent(document.referrer)+"&t="+(new Date).getTime(),A(i,n))},w=function(t,e){b(t,2,function(e){var n=e.split("?")[1],i=n.match(/(^|&|\\?)_rn=([^&]*)(&|$)/);!i||""===i[2]&&null===i[2]||b(t,4)}),e&&A(e)},A=function(t,e){var n=new Image(1,1);n.onload=n.onerror=function(){n=null,e&&e(t)},n.src=t},h=function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},x=function(t,e){var n=t;return n.indexOf("adidx")<0&&(n+="&adidx="+(a(e).index()+1)),n},k=function(t){var e=this,n=e.getAttribute("data-midas"),i=e.getAttribute("data-clickurl");if(h(t),e.getAttribute("data-inner-jump"))l(s,n+"&referer="+encodeURIComponent(document.referrer)+"|"+(i?i:"")),window.location.href=e.getAttribute("data-linkurl");else{var o=t.target,r=o.getAttribute("data-midas-extends"),a=e.getAttribute("data-clickurl"),d=x(n,e),c=d;if(r)c=d+"&"+r;else{var u=p(o,"data-midas-extends");u&&(c=d+"&"+u)}w(c,a)}},C=function(){for(var t=g(),e=0,n=t.length;n>e;e++){var i=t[e],o=i.getAttribute("data-midas"),r=window.pageYOffset||c.scrollTop,a=c.clientHeight,d=m(i),u=i.offsetHeight,s=a+r-d,f=d+u-r,l=(s>=50||s>=u)&&(f>=50||f>=u);o=x(o,i),l&&!i.getAttribute("data-midas-impressed")&&(b(o,3),i.setAttribute("data-midas-impressed","true"))}},j=function(t){h(t),clearTimeout(r),r=setTimeout(function(){C()},200)},I={view:function(){for(var t=g(),e=0,n=t.length;n>e;e++){var i=t[e],o=i.getAttribute("data-midas"),r=i.getAttribute("data-pvurl"),a=i.getAttribute("data-viewed");o=x(o,i),a||(b(o,1),r&&A(r),i.setAttribute("data-viewed",!0))}},initImpression:function(){window.attachEvent?window.attachEvent("onscroll",j):window.addEventListener("scroll",j,!1)},impression:function(){C()},initClick:function(){for(var t=g(),e=0,n=t.length;n>e;e++){var i=t[e],o=(i.getAttribute("data-midas"),i.getAttribute("data-click-inited"));o||(v(i,k),i.setAttribute("data-click-inited","true"))}},sendMidas:b,init:function(){this.view(),this.initClick(),this.impression(),this.initImpression()}};n.exports=I},{main:!0,map:t({"./lib/log-server.js":n},r)}),define(n,[],function(t,e,n,i,o){"use strict";var r=-1;n.exports=function(){var t,e=location.host;return t=e.indexOf("dianping.com")>r&&!/^ppe/.test(e)?location.protocol+"//mlog.dianping.com/log?":location.protocol+"//mlog.51ping.com/log?"}},{map:r})}();
//# sourceMappingURL=midas-log.js.map