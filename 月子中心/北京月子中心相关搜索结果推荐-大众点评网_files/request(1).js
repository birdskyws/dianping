!function(){function t(t,e){for(var s in e)t[s]=e[s];return t}var e="request@1.0.8/lib/ajax.js",s="request@1.0.8/lib/jsonp.js",i="class@~2.0.0",n="json@~1.0.0",r="lang@~1.0.0",a="asset@~1.0.0",c="request@1.0.8/lib/index.js",u={},o=u;define(c,[e,s],function(t,e,s,i,n){"use strict";var r=s.exports={};r.Ajax=t("./ajax"),r.JSONP=t("./jsonp")},{main:!0,map:t({"./ajax":e,"./jsonp":s},o)}),define(e,[i,n,r],function(t,e,s,i,n){"use strict";function r(){return new XMLHttpRequest}function a(t){var e,s=!1;try{e=t.status,s=e>=200&&300>e||1223===e}catch(i){}return s}function c(){}function u(t){return t}function o(){return!0}function h(t,e){return t+(t.indexOf("?")>-1?"&":"?")+e}var l=t("class"),p=t("json"),g=t("lang"),f=4,d=window,m="",v="POST",_="GET",x="json",y="withCredentials",j=/#.*$/,R=d.ActiveXObject?function(){if(d.XMLHttpRequest)try{return r()}catch(t){}try{return new d.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}:r,w={"X-Requested-With":"XMLHttpRequest"},b={Accept:{xml:"aplication/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain","*":"*/*"},"X-Request":{json:"JSON"}},O={xml:"responseXML",text:"responseText"},q=R(),S="onprogress"in q,T=l({Implements:"attrs events",initialize:function(t){var e=g.bind;this.set(t),this.xhr=R(),e("_stateChange",this),S&&(e("_loadstart",this),e("_progress",this))},_stateChange:function(){var t,e=this.xhr;e.readyState===f&&this.running&&(this.running=!1,e.onreadystatechange=c,clearTimeout(this.timer),t=this._parseResponse(e),this.emit(!this.parseError&&this.get("isXHRSuccess")(e)&&this.get("isSuccess")(t)?"success":"error",t,e))},_parseResponse:function(t){var e,s=this.get("santitizer"),i=this.get("parser"),n=this.get("dataType"),r=O;if(e=s(t[r[n]||r.text]||t[r.text]),n.indexOf(x)>-1)try{e=p.parse(e),this.parseError=!1}catch(a){e={},this.parseError=!0}return i(e)},send:function(t){var e=this.get("method"),s=this.get("url"),i=this.get("timeout"),n=this.get("user"),r=this.get("async"),a=this.xhr;this.running=!0,t=this._tidyRequest(t),e===_&&(this.get("cache")||(s=h(s,"_nr_force="+ +new Date)),t&&(s=h(s,t),t=void 0)),S&&(a.onloadstart=this._loadstart,a.onprogress=this._progress),n?a.open(e,s,r,n,this.get("password")):a.open(e,s,r),n&&y in a&&(a[y]=!0),a.onreadystatechange=this._stateChange,g.each(this.get("headers"),function(t,e){try{a.setRequestHeader(e,t)}catch(s){}}),this.emit("request"),a.send(t),!r&&this._stateChange();var c=this;return i&&(this.timer=setTimeout(function(){c.emit("timeout"),c.cancel()},i)),this},_tidyRequest:function(t){return t=(void 0===t?this.get("data"):t)||m,g.isObject(t)&&(t=g.toQueryString(t)),t},_loadstart:function(t){this.emit("loadstart",[t,this.xhr])},_progress:function(t){this.emit("progress",[t,this.xhr])},cancel:function(){var t=this.xhr;return this.running&&(this.running=!1,t.abort(),clearTimeout(this.timer),t.onreadystatechange=c,S&&(t.onprogress=t.onloadstart=c),this.xhr=R(),this.emit("cancel")),self}},{url:{value:m,getter:function(t){return String(t).replace(j,m)||location.pathname}},method:{value:_,setter:function(t){return t=(""+t).toUpperCase(),t===_||t===v?t:_}},dataType:{value:x,setter:function(t){return t||"*"}},async:{value:!0},timeout:{value:0},cache:{value:!1},user:{value:m},password:{value:m},headers:{getter:function(t){g.isObject(t)||(t={});var e=this.get("dataType"),s=this.get("method"),i=b;return g.mix(t,w,!1),g.each(i,function(i,n){var r=i[e];r&&(t[n]=r),s===v&&(t["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8")}),t}},parser:{value:u},santitizer:{value:u},isSuccess:{value:o},isXHRSuccess:{value:a},data:{}});q=null,s.exports=T},{map:o}),define(s,[i,r,a],function(t,e,s,i,n){"use strict";function r(t,e,s){if(t){var i="&",n=t.length-1,r=t[0]===i,a=t[n]===i;t=e?r?t:i+t:r?t.substr(1):t,n=t.length-1,t=s?a?t:t+i:a?t.substr(0,n):err}return t||""}var a=t("class"),c=t("lang"),u=t("asset"),o=+new Date,h="_JSONPCallback",l=a({Implements:"events attrs",initialize:function(t){this.set(t)},_tidyRequest:function(t){return t=(void 0===t?this.get("data"):t)||"",c.isObject(t)&&(t=c.toQueryString(t)),this.get("cache")||(t+="&_nr_force="+ +new Date),t},_getQuestURL:function(t,e,s,i){return t=t.split("?"),t[0]+"?"+r(t[1],!1,!0)+r(s,!1,!0)+e+"="+l._HOLDER_NAME+"._"+i},send:function(t){var e,s=this._tidyRequest(t),i=++o,n=(NR,l._HOLDER),r=this.get("timeout");if(e=this._getQuestURL(this.get("url"),this.get("callbackKey"),s,i),e.length>2083)return this.emit("error",e);var a=this;return n["_"+i]=function(){a.__success.apply(a,arguments),delete n["_"+i]},this._clear(),this.script=u.js(e,!1,{remove:!0}),this.emit("request"),r&&setTimeout(function(){a.emit("timeout"),a.cancel()},r),i},__success:function(){var t=Array.prototype.slice.call(arguments);this.emit.apply(this,["success"].concat(t))},cancel:function(){return this._clear().emit("cancel")},_clear:function(){return this.script=null,this}},{url:{value:""},callbackKey:{value:"callback"},data:{},timeout:{value:0},cache:{value:!1}});l.setNS=function(t){var e,s="";t?(e=window[t],Object(e)!==e&&(e=window[t]={}),s=t+"."):e=window,l._HOLDER_NAME=s+h,l._HOLDER=e[h]||(e[h]={})},l.setNS("NR"),s.exports=l},{map:o})}();
//# sourceMappingURL=request.js.map